晓昊助手 (XiaoHao Assistant)
晓昊助手是一个基于DeepSeek-R1大语言模型的智能聊天助手，具有多种功能特性，包括深度思考模式、多角色定制、用户认证和聊天历史管理。项目采用模块化设计，遵循高内聚低耦合的软件工程原则。

晓昊助手界面

功能特点
🧠 深度思考模式：通过调整模型参数，获得更深入详细的回答，思考过程以Markdown格式优雅呈现
👥 多用户支持：用户注册和登录系统，保存个人对话历史
📚 聊天历史管理：在侧边栏查看和管理所有历史对话
🎭 多角色定制：内置多个专业领域角色，也可自定义创建新角色
🔄 对话连续性：保持上下文连贯的对话体验
🌐 公网访问：支持通过ngrok内网穿透技术实现公网访问
技术栈
前端：Streamlit
后端：Python
模型：DeepSeek-R1 (通过Ollama部署)
存储：基于文件的JSON存储 (可扩展为数据库)
部署：支持本地部署和ngrok内网穿透
安装要求
Python 3.8+
Ollama 服务运行 DeepSeek-R1 模型
所需Python库（见requirements.txt）
本地开发环境设置
克隆仓库
git clone <仓库地址>
cd 晓昊助手
创建虚拟环境并安装依赖
python -m venv venv
source venv/bin/activate  # 在Windows上使用: venv\Scripts\activate
pip install -r requirements.txt
确保Ollama已安装并运行DeepSeek-R1模型
ollama pull deepseek-r1:7b
启动应用
python run.py
在浏览器中访问 http://localhost:8501
公网部署（使用ngrok）
要将应用部署到公网，可以使用ngrok实现内网穿透：

安装pyngrok库
pip install pyngrok
注册ngrok账号并获取授权token

运行应用并启用ngrok

python run.py --use-ngrok --ngrok-token YOUR_NGROK_TOKEN
应用启动后会在终端和应用侧边栏显示可访问的公网URL，例如：
晓昊助手已通过ngrok部署到: https://abcd1234.ngrok.io
访问该URL即可从公网连接到您的晓昊助手
项目结构详解
项目采用模块化设计，遵循高内聚低耦合原则，整体结构如下：

晓昊助手/
├── app/                      # 主应用代码
│   ├── __init__.py           # 应用包初始化
│   ├── main.py               # 应用入口点和核心逻辑
│   ├── config.py             # 配置设置和常量
│   ├── auth/                 # 认证相关代码
│   │   ├── __init__.py       # 认证模块初始化
│   │   └── user_manager.py   # 用户认证和管理类
│   ├── chat/                 # 聊天功能
│   │   ├── __init__.py       # 聊天模块初始化
│   │   ├── chat_manager.py   # 聊天历史和操作类
│   │   └── message_handler.py # 消息处理逻辑
│   ├── models/               # 数据模型
│   │   ├── __init__.py       # 模型模块初始化
│   │   ├── user.py           # 用户模型类
│   │   ├── chat.py           # 聊天模型类
│   │   └── persona.py        # 角色模型类
│   ├── storage/              # 存储操作
│   │   ├── __init__.py       # 存储模块初始化
│   │   └── file_storage.py   # 基于文件的存储实现
│   ├── llm/                  # 大语言模型集成
│   │   ├── __init__.py       # LLM模块初始化
│   │   └── ollama_client.py  # Ollama客户端封装
│   └── ui/                   # 用户界面组件
│       ├── __init__.py       # UI模块初始化
│       ├── main_view.py      # 主聊天界面
│       ├── auth_view.py      # 认证视图
│       ├── sidebar_view.py   # 侧边栏组件
│       └── persona_view.py   # 角色管理界面
├── data/                     # 数据存储目录
│   ├── users/                # 用户数据
│   ├── chats/                # 聊天历史
│   └── personas/             # 角色定义
├── tests/                    # 测试目录
├── requirements.txt          # 项目依赖
├── README.md                 # 项目文档
├── TO-DO-LIST.md             # 项目任务清单
└── run.py                    # 应用启动脚本
核心模块解析
1. 配置模块 (config.py)
负责应用的全局配置，包括文件路径、Ollama设置、UI配置、默认角色定义和日志配置。这些设置集中管理，便于统一修改和维护。

2. 数据模型模块 (models/)
定义应用中使用的数据结构，采用类的形式使数据处理更加规范和清晰：

user.py: 用户模型，处理用户信息
chat.py: 聊天记录模型，包含消息列表和元数据
persona.py: 角色模型，定义AI助手的不同角色特性
3. 存储模块 (storage/)
处理数据持久化，目前使用基于文件的JSON存储：

file_storage.py: 提供用户数据、聊天记录和角色配置的存储和读取操作，使用统一的接口方便将来扩展为数据库存储
4. 认证模块 (auth/)
处理用户身份验证相关功能：

user_manager.py: 提供用户注册、认证等功能，与存储层交互
5. 聊天模块 (chat/)
处理聊天核心功能：

chat_manager.py: 管理聊天会话的创建、加载和保存
message_handler.py: 处理消息内容，与LLM API交互获取回复，包含深度思考模式的格式化处理
6. LLM集成模块 (llm/)
负责与大语言模型的交互：

ollama_client.py: 封装Ollama API调用，提供统一接口处理深度思考模式等自定义选项
7. UI模块 (ui/)
使用Streamlit构建用户界面：

auth_view.py: 认证界面，处理登录和注册，支持页面切换
main_view.py: 主聊天界面，显示消息历史和处理用户输入
sidebar_view.py: 侧边栏界面，包含聊天历史、设置、角色选择和创建
persona_view.py: 角色管理界面，用于创建和显示角色信息
8. 应用核心 (main.py)
应用的核心类，整合各模块功能，负责:

初始化各组件
处理UI事件和用户操作
协调数据流动
管理应用状态
9. 启动脚本 (run.py)
入口点脚本，启动整个应用，支持标准启动和ngrok内网穿透。

深度思考模式
深度思考模式是本应用的特色功能之一，启用后：

展示思考过程：AI助手会在回答问题前先展示其思考过程，用Markdown引用块格式（>）优雅地展示
更详细的回答：通过调整LLM参数，生成更长、更深入的回答
可视化标识：界面会显示"深度思考模式已启用"的提示
可随时开关：在侧边栏设置中可以随时开启或关闭此功能
未启用深度思考模式时，AI会直接给出简洁的回答，没有思考过程的展示。

使用指南
注册和登录
首次使用时，需要先注册账号。在登录页面点击"点此注册"链接，填写用户名和密码，然后点击"注册"按钮。注册完成后，系统会自动跳转到登录页面，使用刚才的凭据登录系统。

创建新对话
登录后，点击侧边栏中的"新建对话"按钮开始新的对话。每个新对话都会自动保存并显示在对话历史列表中。

使用深度思考模式
在侧边栏的设置部分，勾选"深度思考模式"复选框可以启用此功能。启用后，AI会在回答前先展示其思考过程，并生成更详细、深入的回答，但响应时间可能会增加。

切换和创建角色
在侧边栏的"选择角色"下拉列表中选择预设角色
点击"创建新角色"展开器，填写角色信息创建新角色
系统提示词决定了AI角色的行为和专业领域，可以根据需要定制
管理对话历史
所有对话都会自动保存到用户账户中。可以在侧边栏的"对话历史"部分查看和继续之前的对话。

架构设计原则
项目遵循以下设计原则：

高内聚低耦合: 每个模块专注于单一职责，减少模块间的依赖
依赖注入: 通过构造函数传递依赖，便于测试和替换实现
分层架构:
表示层: UI组件负责界面展示
业务逻辑层: 各Manager类处理业务规则
数据访问层: Storage类负责数据持久化
模型层: 定义数据结构和业务实体
单一职责: 每个类和函数只负责一个明确定义的任务
安全说明
当前版本使用基本的文件存储系统和简单的密码存储。生产环境部署前，请参考 TO-DO-LIST.md 中的"安全性增强"部分进行必要的安全加固。

未来计划
请参考 TO-DO-LIST.md 了解计划中的功能和改进。

贡献指南
欢迎贡献代码、报告问题或提出功能建议。请通过GitHub Issues或Pull Requests参与项目改进。

许可证
[选择适当的许可证]
